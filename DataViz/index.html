<!DOCTYPE html>
<meta charset="utf-8">
<head>
	<title>Happiness</title>
</head>

<style>
	body {
		font-family: "Helvetica Neue", Helvetica, sans-serif;
		font-size: 14px;
	}
	#wrapper {
		height: 220px;
	}

	.person {
		height: 20px;
		position: relative;
	}
	.person .label {
		width: 90px;
		text-align: right;
	}
	.person .bar {
		height: 19px;
		background-color: steelblue;
		position: absolute;
		left: 100px;
	}
	.person div {
		display: inline-block;
	}
	.data-view {
		padding: 10px;
		color: #777;
		font-size: 12px;
		width: 700px;
	}
</style>

<body onload=initialiseData()>

	<div id="wrapper">
	</div>

	<div class="menu">
		<button onClick="updateScores();">Update scores</button>
		<button onClick="addPerson();">Add person</button>
		<button onClick="removePerson();">Remove person</button>
	</div>

	<!-- <div class="data-view"></div> -->

	<script src='https://d3js.org/d3.v5.min.js'></script>
	<script>

	var myData = [];
	var barWidth = 400;
	var barScale = d3.scaleLinear().domain([1, 10]).range([0, barWidth]);

	function randomInteger(n) {
		return Math.floor(10 * Math.random());
	}

	async function  initialiseData() {
	    myData = await d3.csv("https://ashagp2.github.io/mcs-ds/DataViz/2017.csv")
			update();

	}

	function updateBars(data) {
		var u = d3.select('#wrapper')
			.selectAll('.person')
			.data(data, function(d) {
				return d.Country;
			});

		var entering = u.enter()
			.append('div')
			.classed('person', true);

		entering.append('div')
			.classed('label', true)
			.text(function(d) {
				return d.Country;
			});

		entering.append('div')
			.classed('bar', true);

		entering
			.merge(u)
			.select('.bar')
			.transition()
			.style('width', function(d) {
				return barScale(d.HappinessScore) + 'px';
			});

		u.exit().remove();
	}

	function addPerson() {
		
	}

	function removePerson() {
		if(myData.length === 0)
			return;

		myData.pop();

		update(myData);
	}

	function updateScores() {
		for(var i = 0; i < myData.length; i++) {
			myData[i].score = 30 + randomInteger(70);
		}

		update(myData);
	}

	function updateDataView() {
		d3.select('.data-view').text('Array: ' + JSON.stringify(myData));
	}

	function update() {
		updateBars(myData);
		updateDataView(myData);
	}

	initialiseData();


	</script>
</body>
</html>
